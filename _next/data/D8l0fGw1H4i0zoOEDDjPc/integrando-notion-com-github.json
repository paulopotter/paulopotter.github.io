{"pageProps":{"post":{"title":"Integrando Notion com Github","category":["Produtividade","Automa√ß√£o"],"date":"2024-10-02 11:24","cover_image":"https://umdevqualquer.com.br/images/integrando-notion-com-github/Frame_1_IeNLNpP5.png","cover_image_alt":"Imagem com a logo da notion + logo github actions","cover_image_link":null,"cover_image_by":null,"series":[],"summary":"Mas como o titulo do post da o spoiler, eu descobri uma forma de facilitar a minha cria√ß√£o de post utilizando o poder do Notion, sem tirar a liberdade que eu possuo em ter o meu blog feito por mim e hospedado no Github pages.","slug":"integrando-notion-com-github","content":"Fala pessoa, como c√™ t√°?\n\nSim, o blog n√£o morreu üòÇ, eu s√≥ n√£o tenho conseguido escrever nada. Por mais que meus posts sejam como especial de natal, que s√≥ aparece uma vez por ano e n√£o necessariamente √© t√£o bom ü§£ü§£.\n\nEu tenho estado muito ocupado e acabo n√£o conseguido parar pra escrever, principalmente pela forma que eu preciso pra escrever. Meu blog √© feito com NextJS e hospedado via Github pages e por isso, eu preciso ou estar no meu pc + escrever + realizar o build e postar ou baixar o projeto + instalar depend√™ncias + escrever + realizar o build e ent√£o postar. O que aumenta o ‚Äúcusto‚Äù na hora de escrever (*Resumindo, da pregui√ßa!*).\n\nMas como o titulo do post da o spoiler, eu descobri uma forma de facilitar a minha cria√ß√£o de post utilizando o poder do Notion, sem tirar a liberdade que eu possuo em ter o meu blog feito por mim e hospedado no Github pages.\n\nEu tenho trabalhado muito voltado ao DX ( e esse assunto j√° est√° na lista de posts pra escrever ) mas eu mesmo n√£o fa√ßo isso pra mim ( o cl√°ssico ‚Äú*em casa de ferreiro, o espeto √© de pau*‚Äù ).\n\n## Conhecendo as ferramentas\n\n*   [**Notion**](https://notion.so/)\n\n    Onde eu pretendo escrever e gerenciar os posts do meu blog.\n\n    *Se voc√™ n√£o conhece o* [*Notion*](https://notion.so/) *eu recomendo, √© uma grande ferramenta que ajuda em v√°rios pontos da minha vida.*\n\n*   [**Github**](https://github.com/) (Pages e Actions)\n\n    Hoje eu j√° hospedo o meu blog via Github Pages, visto que o blog √© est√°tico e finalmente vou utilizar o Github Actions para fazer o build e o deploy do blog.\n\n*   [**Next JS**](https://nextjs.org/)\n\n    Para gerar os est√°ticos eu fiz o meu blog inteiro utilizando o Next.\n\n## Come√ßando pelo o come√ßo\n\nEu, a um tempo, estava incomodado de n√£o ter criado uma pipeline pra fazer os testes e o build/deploy do meu blog, mas mais incomodado ainda em n√£o estar postando com frequ√™ncia, principalmente porque hoje para mim √© cansativo escrever um post.\n\nHoje estou mais acostumado com o Gitlab CI, visto que na Globo usamos o Gitlab. Eu j√° conhecia o Github Actions, mas nunca havia mexido. Ent√£o acabava postergando o aprendizado e a utiliza√ß√£o do Github actions.\n\nEm um dado momento, dado a praticidade de utilizar o Notion, eu acabei me perguntado se n√£o era poss√≠vel integrar ele com o meu Blog, para facilitar o gerenciamento dos posts e assim me incentivar a escrever mais ( ainda mais porque eu to cheio de ideias de post mas sem saco de passar pelo o processo de escrita que possuo hoje ).\n\nCom isso, acabei encontrando uma action para o Github, que faz o a integra√ß√£o com o Notion, por√©m eu tive uma certa dificuldade para configur√°-lo üòû, a documenta√ß√£o dele foi a melhor que eu achei dessas actions, por√©m j√° est√° meio desatualizada e n√£o tem algumas infos importantes, que eu quebrei a cabe√ßa para entender.\n\nChega de hist√≥ria, vamos para a a√ß√£o!\n\n## Notion\n\nPara facilitar a visualiza√ß√£o, vamos come√ßar adaptando o Notion para esperar a integra√ß√£o com o Github, para isso vamos criar uma pagina de database e nela vai ficar listada todos os posts que ser√£o publicados no blog. Ent√£o coloque as propriedade que voc√™ quiser, no meu caso ficou assim:\n\n![Print da tela do database do notion com as colunas: Status, title, uri, date, category e series](public/images/integrando-notion-com-github/Untitled_eiWcVbHV.png)\n\n*Os campos podem ser quais voc√™ quiser, porem √©* ***obrigat√≥rio*** *possuir o campo ‚Äústatus‚Äù (ou outro que fa√ßa o mesmo trabalho, que voc√™ entender√° mais a frente).*\n\n> *Spoiler*: At√© ent√£o, eu usava o campus ‚Äú*Status*‚Äù como um do tipo `select` e depois eu descobri que j√° existia o tipo `status` , o que facilita muito a utiliza√ß√£o mas que me deu muita dor de cabe√ßa para resolver  isso.\n\nCom essa tabela criada, j√° possu√≠mos uma estrutura onde podemos criar todos os nossos post e, de brinde, criar status onde voc√™ pode saber se j√° est√° postado, escrevendo ou √© apenas uma ideia.\n\n### Iniciando a integra√ß√£o\n\n*   Agora para preparar o terreno para integra√ß√£o vamos adicionar uma conex√£o, nas op√ß√µes da tabela, v√° at√© gerenciamento de conex√£o (Manage connections)\n\n![](public/images/integrando-notion-com-github/Screenshot_2023-05-13_at_22.15.11_MrwGbdGu.png)\n\n*   Na janela que abrir, procure no fim da tela o campo: *Developer or manager integrations*\n\n![](public/images/integrando-notion-com-github/Screenshot_2023-05-13_at_22.15.33_steevlxE.png)\n\n*   Ele vai te redirecionar at√© a area de integra√ß√µes de api do Notion\n\n![](public/images/integrando-notion-com-github/Screenshot_2023-05-13_at_22.15.56_ov6UkFNN.png)\n\n*   Clique para adicionar uma nova integra√ß√£o ( New Integration ) e preencha o campo de Name com o nome que voce quiser dar, uma imagem para voc√™ saber o que voc√™ est√° associando e qual o workspace do notion essa api vai ser associada.\n\n![](public/images/integrando-notion-com-github/Screenshot_2023-05-13_at_22.17.13_Phkhc4Mp.png)\n\nAp√≥s criado ele ir√° gerar uma **secret key,** guarde ela que iremos utiliza-la mais a frente. (Voc√™ consegue acessar ela a hora que voc√™ quiser, n√£o se preocupe).\n\n*   Depois disso, voltamos para a nossa tabela e acessamos a configura√ß√£o dela, e no campo de conex√£o, a gente adiciona a  integra√ß√£o que acabamos de criar.\n\n![](public/images/integrando-notion-com-github/Screenshot_2023-05-13_at_22.18.47_ceLhH8eS.png)\n\nPronto! A parte referente ao Notion foi finalizada üòÑ\n\n## Github actions (Gh Actions)\n\nEu n√£o vou mostrar uma config completa e/ou explicar como funciona o Github Actions, at√© porque eu ainda estou aprendendo/ me entendendo com ele.\n\n### Environments\n\nVamos criar logo as nossas vari√°veis de ambiente para ser utilizada na pipeline.\n\n*   V√° at√© as configura√ß√µes do seu projeto e acesse o menu ‚Äú**Environments**‚Äù,\n\nNessa tela voc√™ ter√° duas formas de criar vari√°veis de ambiente, uma secreta e outra aberta.\n\n*   Na parte de cria√ß√£o das vari√°veis secretas, n√≥s vamos criar duas: **NOTION\\_ROOT\\_PAGE\\_ID** e **NOTION\\_TOKEN**,  onde os valores deles ser√£o a url da database do notion e a **secret key** obtido na explica√ß√£o do Notion, respectivamente.\n\n![](public/images/integrando-notion-com-github/Untitled_PZuYnY8i.png)\n\n*   Na parte da cria√ß√£o das vari√°veis, eu preferi criar 3 vari√°veis, para me dar a liberdade de n√£o ter que ficar mexendo no c√≥digo toda hora que eu precisar alterar alguma info que a action usa para tratar os dados do notion. Essas vari√°veis s√£o: **FILTER\\_PROP**, **FILTER\\_VALUES** e  **POST\\_URI**. Onde:\n\n    *   **FILTER\\_PROP** fica o nome do campo onde eu quero que o Github filtre para saber qual o post ele ter√° que publicar.\n\n    *   **FILTER\\_VALUES** fica o valor do campo que, quando um post tiver esse valor no campo de filtro, ser√° o indicativo para o Github para saber que √© o post ele ter√° que publicar.\n\n    *   **POST\\_URI** √© o nome do campo onde ele vai usar o valor final (como o nome do post, por exemplo) para ajudar a montar o path de arquivos.\n\n![](public/images/integrando-notion-com-github/Untitled_dfykuUjD.png)\n\n### Criando seu job / action:\n\nPesquisando, acabei caindo na action [Notion jam](https://github.com/victornpb/notion-jam), que pega os dados e gera um arquivo markdown. Tamb√©m peguei outras actions, o [git auto commit action](https://github.com/stefanzweifel/git-auto-commit-action) e o [GitHub push action](https://github.com/ad-m/github-push-action) para poder fazer um commit e puxar o arquivo criado na branch que eu to usando.\n\nPara facilitar a explica√ß√£o, eu vou colar o meu arquivo de actions aqui\n\n```yaml\nname: Sync Notion pages to posts\n\non:\n  schedule:\n    - cron: '0 13 * * *' # daily\n\n  workflow_dispatch:\n\njobs:\n  get_and_commit_notions_posts:\n    runs-on: ubuntu-latest\n    environment: github-pages\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: notion-jam\n        uses: victornpb/notion-jam@v0.0.13\n        with:\n          NOTION_SECRET: ${{ secrets.NOTION_TOKEN}}\n          NOTION_DATABASE: ${{ secrets.NOTION_ROOT_PAGE_ID }}\n          FILTER_PROP: ${{ vars.FILTER_PROP }}\n          FILTER_VALUES: ${{ vars.FILTER_VALUES }}\n          ARTICLE_PATH: src/posts/${{ vars.POST_URI }}.md\n          ASSETS_PATH: public/images/${{ vars.POST_URI }}/\n          PARALLEL_PAGES: 25\n          PARALLEL_DOWNLOADS_PER_PAGE: 3\n          DOWNLOAD_IMAGE_TIMEOUT: 30\n\n      - name: Save changes\n        uses: stefanzweifel/git-auto-commit-action@v4\n        with:\n          commit_message: 'docs: add new post'\n      - uses: ad-m/github-push-action@master\n        with:\n          github_token: ${{ secrets.GITHUB_TOKEN }}\n          branch: ${{ github.ref }}\n```\n\n[Link para o action atualizado](https://github.com/paulopotter/paulopotter.github.io/blob/nextjs/.github/workflows/notion.yml)\n\n## Bonus track\n\nPara facilitar ainda mais a minha vida, eu consegui criar um template na hora de criar um post, dentro do notion, onde ele j√° preenche alguns campos para mim. Al√©m de criar bot√µes de cria√ß√£o r√°pida de post, onde ele j√° preenche alguns dados de acordo com o conte√∫do do bot√£o.\n\n![](public/images/integrando-notion-com-github/Untitled_eYlw5f4q.png)\n\n## Problemas e aprendizados\n\n### N√£o suporte a certas propriedades\n\nComo eu havia dito antes, eu resolvi trocar o tipo do campo ‚ÄúStatus‚Äù de `select` para `status` e com isso a minha pipeline parou de funcionar e n√£o s√≥ isso a ‚ÄúCategoria‚Äù n√£o estava sendo exibida (e depois eu descobri que as ‚ÄúSeries‚Äù tamb√©m n√£o).\n\nDepois de muito bater a cabe√ßa eu descobri que a action ‚Äúnotion-jam‚Äù n√£o dava suporte para os tipo `relation` (que s√£o o caso dos campos ‚Äúcategoria‚Äù e ‚Äúseries‚Äù) e `status` o que fazia com que metade da prepara√ß√£o que eu havia criado, ir pelo o ralo a baixo.\n\nEnt√£o resolvi fazer um [fork da action](https://github.com/paulopotter/notion-jam) e adicionar o suporte eu mesmo para esses tipos e como adicional eu tamb√©m corrigi uma parada que me incomodava quando eu usava o tipo `formula`.\n\nJ√° abri um [Pull Request para a action original](https://github.com/victornpb/notion-jam/pull/5) com essas mexidas, mas enquanto ele n√£o aprova, eu estou usando o meu fork para rodar a minha pipeline. Caso voc√™ queira usar a minha action (ou usar a original quando j√° estiver mergeada), recomendo olhar o meu arquivo de action do blog, pois foram adicionados novos campos que eu n√£o coloquei neste post.\n\nNota adicional: caso voc√™ queira usar uma coluna que √© uma rela√ß√£o com outra tabela, a outra tabela tamb√©m precisa ter a integra√ß√£o que fizemos anteriormente. (apenas o passo 5 da integra√ß√£o)\n\n### Dificuldades\n\nDois pontos que ainda n√£o consegui resolver, mas devo atualizar o post quando descobrir s√£o:\n\n*   que √© dif√≠cil utilizar tags HTML, pois quando chega via api, chega ‚Äúencodada‚Äù.  E hoje eu utilizo para gerar o resumo da home e do RSS. (Sim, o blog tem RSS).\n    Al√©m disso o pr√≥prio notion formata o texto, hoje para conseguir usar algumas  tags HTML eu preciso escrever em outro lugar e depois copiar para o notion, para ele manter a tag sem formatar os caracteres.\n\n*   que mesmo se eu n√£o editar um post, ele baixa o post novamente e faz um novo commit. E as vezes isso acaba falhando a pipe.\n    Vou precisar fazer um diff para n√£o ficar fazendo commit sem ter novas altera√ß√µes. Por√©m n√£o estou conseguindo isso na pipe.\n\n## **That\\`s all folks**\n\nEu ainda estou descobrindo o que eu posso fazer no Notion e isso refletir no meu Blog, ainda n√£o sei se todas as funcionalidades que eu tenho no blog eu consigo criar via o Notion. Talvez, posts mais complexos ainda precisem ser manuais.\n\nAinda tenho como meta, conseguir ver uma forma de publicar nas redes sociais automaticamente, talvez at√© via Github actions tamb√©m, mais infelizmente n√£o vai ser dessa vez.\n\n√â isso, espero que esse post te ajude em algo üòÉ.\n\nE com muito orgulho, esse √© o primeiro post que eu fiz a partir dessa integra√ß√£o! Espero que a partir de agora eu consiga manter o blog mais atualizado, gra√ßas a essa facilidade.\n\nValeu, Falow, at√© a pr√≥xima!\n","readingTime":"9 min","related":{"nextPost":{"title":"Meus 10 anos de Globo","date":"2025-02-24 18:00","slug":"meus-10-anos-de-globo"},"prevPost":{"title":"Utilizando ARIA no seu projeto - Tooltip","date":"2022-07-17","slug":"utilizando-aria-no-seu-projeto-tooltip"}}}},"__N_SSG":true}