{"pageProps":{"post":{"title":"Criando sua primeira APP para Smart TVs","category":["Smart TV","Js","React"],"date":"2020-01-19","cover_image":"https://umdevqualquer.com.br/images/smart-tv-pixabay.jpg","cover_image_alt":"Smart Tv from pixabay","cover_image_link":"https://pixabay.com/pt/illustrations/remoto-controle-tela-tv-explora√ß√£o-3653882/","cover_image_by":"Imagem retirada de PixaBay","series":[{"title":"Criando sua primeira APP para Smart TVs","date":"2020-01-19","series":"Criando sua primeira APP para Smart TVs"},{"title":"Criando sua primeira APP para Smart TVs (Parte 2)","date":"2020-04-09","series":"Criando sua primeira APP para Smart TVs","slug":"criando-sua-primeira-app-para-smart-tvs-parte-2"}],"summary":"Fala ae, tranquilinho?\n\nHoje eu estou aqui para mostrar o desenvolvimento de uma app simples para Smart Tv. Como eu havia prometido [neste post](./como-e-o-desenvolvimento-para-smart-tvs.html). Recomendo a leitura, √©","slug":"criando-sua-primeira-app-para-smart-tvs","content":"Fala ae, tranquilinho?\n\nHoje eu estou aqui para mostrar o desenvolvimento de uma app simples para Smart Tv. Como eu havia prometido [neste post](./como-e-o-desenvolvimento-para-smart-tvs.html). Recomendo a leitura, √© uma boa introdu√ß√£o.\n\nTendo a ideia de tentar passar por boa partes dos problemas que temos quando desenvolvemos app para TVs, pensei em v√°rios tipos diferentes de exemplo de apps: galeria de fotos, app de streaming de m√∫sica, app de streaming de animes (~~para ter uma experi√™ncia melhor que a sua, Crunchyroll~~)... Por√©m para ser algo mais r√°pido e simples, eu tive que me conter ü§™\n\n## O Projeto:\n\nCom isso em mente, a escolha que mais se encaixou nesses requistos foi: **app que simula um cat√°logo de animes/mang√°**.\nAp√≥s essa s√©rie de posts, se voc√™s quiserem, eu fa√ßo um mais \"real\", com request a v√°rias APIs, player para tocar algo, entre outras coisas (*N√£o se esque√ßa de comentar!!*). Ser√° um app relativamente simples, por√©m como o post ficar√° muito logo eu irei criar uma s√©rie de posts. E lembrando: esse ser√° um projeto web hosted focado para as Smart Tvs da Samung (Tizen) e LG (WebOs).\n\nNesse projeto n√≥s iremos desde a cria√ß√£o de uma app na sua m√°quina at√© voc√™ ver ela funcionando na sua TV üòÜ. Com isso ensinarei como fazer uma app e quais seriam os passos para publicar a sua app.\n\n## Ferramentas:\n\nBasicamente n√≥s iremos utilizar essa stack para desenvolver:\n\n*   React\n*   Webpack\n*   Jest\n*   HTML/CSS\n*   <strike>Stackoverflow</strike>\n\nPor√©m, voc√™ √© livre para escolher a sua, podendo utilizar qualquer framework para desenvolver. *Vue.js, React, Flutter, JS Vanilla*, s√£o alguns exemplos. Voc√™ s√≥ n√£o pode esquercer de duas premissas: **compatibilidade** e **performance**! Ent√£o vamos fazer essa baga√ßa funcionar!!!\n\n### Configurando o projeto:\n\n![E la vamos n√≥s](./images/criando-sua-primeira-app-para-smart-tvs/tenor.png)\n\n<center><br/><sup>Creditos: google</sup></center>\n\nAqui √© aquela configura√ß√£o padrao: aquele nosso `create-react-app` b√°sico (se voc√™ n√£o tem o *create-react-app* √© s√≥ usar o `npm install -g create-react-app`). Com isso, j√° come√ßamos a ter a nossa estrutura inicial.\n\n```bash\n$ create-react-app my-first-smart-tv-app\n```\n\nNota: *Para fins pr√°ticos e educacionais, eu n√£o irei otimizar a nossa app ao m√°ximo, me atentarei para o funcionamento b√°sico de uma app.*\n\nContinuando, agora est√° na hora de adicionar o babel e o webpack, segue os comandos:\n\n```bash\n# Webpack\n$ yarn add -D webpack webpack-cli webpack-dev-server html-webpack-plugin html-loadert\n# babel\n$ yarn add -D @babel/core babel-loader @babel/preset-env @babel/preset-react babel-preset-es2015\n# Sass/css\n$ yarn add -D sass-loader node-sass css-loader mini-css-extract-plugin\n```\n\n√â necess√°rio fazer algumas configura√ß√µes para o funcionamento do webpack/babel ap√≥s a instala√ß√£o, como eu mexi em v√°rios arquivos, [aqui est√° o commit com essas modifica√ß√µes](https://github.com/paulopotter/my-first-smart-tv-app/commit/6a5b5f4).\n\nCom isso n√≥s j√° temos a estrutura da nossa APP.\n\n### Come√ßando o desenvolvimento:\n\nAntes que eu me esque√ßa, estarei postando essa [app no github](https://github.com/paulopotter/my-first-smart-tv-app), com isso se voc√™ quiser apenas o resultado final, estar√° tudo documentado l√°.\n\nAgora vamos come√ßar a codar de verdade, para isso vamos fazer um request para a API que vai nos entregar os dados que a gente precisa, para isso vamos utilizar o [Jikan](https://jikan.moe/?ref=public-apis). O Jikan √© uma API n√£o oficial do [My Anime List](https://myanimelist.net), ela √© bem completinha para o que iremos fazer üòÜ. E para ele existe um *wrapper* em js ([jikanjs](https://github.com/zuritor/jikanjs)) para facilitar ainda mais a nossa vida, para instalar basta rodar.\n\n```bash\n$ yarn add jikanjs\n```\n\nCom isso j√° temos acesso a api, voc√™ pode fazer um teste colocando no `App.js` o seguinte trecho de c√≥digo:\n\n```jsx\nrender() {\n  jikanjs\n  .loadSeasonLater()\n  .then((response) => {\n      response.anime.forEach(element => {\n          console.log(`${element.mal_id}: ${element.title} - ${element.image_url} - ${element.type}`);\n      })\n  }).catch((err) => {\n      console.error(err); // in case a error happens\n  });\n  return <h1> Hello World :) </h1>;\n}\n```\n\nAbra o seu console e voc√™ ver√° a resposta do servidor.\n\nVamos colocar esses dados na tela, e para isso vamos criar uma estrutura HTML:\n\n```jsx\ntmpl(anime){\n  const {image_url, title, mal_id, type} = anime\n\n  return (\n    <div className=\"poster-wrapper\" id={mal_id} key={mal_id}>\n      <figure>\n        <span>{type}</span>\n        <img src={image_url} alt={title} />\n        <p>{title}</p>\n      </figure>\n    </div>\n  )\n\n}\n```\n\ne depois vamos fazer o request, para isso vamos adicionar o `state` e o `componentDidMount`:\n\n```jsx\nconstructor(props) {\n  super(props)\n  this.state = {\n      animes: []\n  }\n}\n\ncomponentDidMount() {\n  let animes = []\n  jikanjs\n  .loadSeasonLater()\n  .then((response) => {\n      response.anime.forEach(element => {\n          animes.push(element);\n      })\n      this.setState({ animes })\n  }).catch((err) => {\n      console.error(err); // in case a error happens\n  });\n}\n```\n\nE agora vamos adicionar no `render` o conte√∫do.\n\n```jsx\nrender() {\n    let animes = this.state.animes;\n    return animes.map((anime) => (anime.type === 'TV' ? this.tmpl(anime) : null))\n}\n```\n\nPronto, com isso j√° temos todos os itens sendo exibidos na p√°gina!\n\n### Vamos passar a primeira maquiagem:\n\nA ideia aqui √© s√≥ tornar a nossa visualiza√ß√£o melhor, n√£o tem muita regra e ainda nem adicionei um pr√©-processador.\n\n```css\nbody {\n  background-color: #0f0f0f;\n  color: #f1f1f1;\n}\n\n.poster-wrapper {\n  display: inline-block;\n  text-align: center;\n  width: 310px;\n}\n\n.poster-wrapper--active {\n  outline: 1px solid #f1f1f1;\n}\n```\n\n### Test, Jest everywhere...\n\nN√≥s n√£o podemos esquecer de fazer os testes da nossa app (*ou de qualquer c√≥digo que fa√ßamos*), para isso vamos instalar o jest:\n\n```bash\n$ yarn add -D jest babel-jest enzyme jest-environment-enzyme jest-enzyme enzyme-adapter-react-16 identity-obj-proxy\n$ yarn jest --init\n```\n\nna linha 2 a gente cria a configura√ß√£o inicial do jest automaticamente, √© s√≥ seguir a sequ√™ncia `jsdom, y, y`, com isso ele cria um arquivo chamado `jest.config.js`. Nele fa√ßa a modifica√ß√£o nas linhas 82, 129, 135 e 144:\n\n```js\nmoduleNameMapper: { // 82\n  \"\\\\.(css|sass)$\": \"identity-obj-proxy\",\n},\nsetupFilesAfterEnv: [\"<rootDir>/src/setupTests.js\"], // 129\ntestEnvironment: \"enzyme\", // 135\ntestMatch: [ // 144\n  \"**/*.test.js\",\n],\n```\n\nTamb√©m precisamos criar o arquivo `src/setupTest.js` e dentro dele colocar:\n\n```jsx\nimport { configure } from \"enzyme\";\nimport Adapter from \"enzyme-adapter-react-16\";\nconfigure({ adapter: new Adapter() });\n```\n\nCom isso s√≥ falta alterar o nosso `package.json` para rodar os testes e coverage:\n\n```json\n{\n  // ...\n  scripts: {\n    // ...\n    \"test\": \"jest\",\n    \"test:coverage\": \"jest --coverage\"\n  }\n}\n```\n\nTamb√©m adicionei o ESLint, para ver como ficou, olhe [esse commit](https://github.com/paulopotter/my-first-smart-tv-app/commit/853e5bf).\n\n## Navega√ß√£o\n\nPara fazer a navega√ß√£o, eu vou adicionar uma classe para indicar a sele√ß√£o:\n\n```jsx\ntmpl(anime, i) {\n    // ...\n        <div className={`poster-wrapper ${this.state.activeItem === i ? 'poster-wrapper--active': null}`} id={mal_id} key={mal_id}>\n    // ...\n}\n\nrender() {\n    // ...\n    return animes.map((anime, i) => (anime.type === 'TV' ? this.tmpl(anime, i) : null))\n    // ...\n}\n```\n\ne agora a gente ouve os eventos do teclado:\n\n```jsx\nonKeyDown(e) {\n    const { activeItem, animes } = this.state\n    let newActiveItem = activeItem\n    switch (e.keyCode) {\n      case 37: // left\n        if (activeItem !== 0) {\n          newActiveItem -= 1\n        }\n        break\n\n      case 39: // right\n        if (activeItem < animes.length) {\n          newActiveItem += 1\n        }\n        break\n\n      case 40: // down\n        if (activeItem < animes.length) {\n          if (activeItem + 4 > animes.length) {\n            newActiveItem = animes.length\n          } else {\n            newActiveItem += 4\n          }\n        }\n        break\n      case 38: // up\n        if (activeItem < animes.length) {\n          if (activeItem - 4 < 0) {\n            newActiveItem = 0\n          } else {\n            newActiveItem -= 4\n          }\n        }\n        break\n      default:\n        break\n    }\n    this.setState({\n      activeItem: newActiveItem\n    })\n  }\n```\n\npara essa fun√ß√£o funcionar a gente ainda precisa adicionar as seguintes linhas:\n\n```jsx\nconstructor(props) {\n  // ...\n  this.onKeyDown = this.onKeyDown.bind(this)\n}\ncomponentDidMount() {\n  // ...\n    this.enableKeyEvent()\n}\n\ncomponentWillUnmount() {\n    this.disableKeyEvent()\n}\n\nenableKeyEvent() {\n    document.addEventListener('keydown', this.onKeyDown, true)\n}\n\ndisableKeyEvent() {\n    document.removeEventListener('keydown', this.onKeyDown, true)\n}\n```\n\n## That\\`s it\n\n√â isso, para a nossa primeira parte isso j√° √© o suficiente para come√ßar a brincar ( e porque se eu continuar o post vai demorar 3 horas para ser lido ü§™)\nPara ver todos os commits desse post, acesse [essa tag no github](https://github.com/paulopotter/my-first-smart-tv-app/releases/tag/post-1)\n\nNo pr√≥ximo post, n√≥s teremos a continua√ß√£o dos testes, fix de alguns bugs e cria√ß√£o de algum evento para quando selecionar-mos um item.\n\nQualquer d√∫vida, critica ou sugest√£o utilizem os coment√°rios e at√© a pr√≥xima!!\n","readingTime":"6 min","related":{"nextPost":{"title":"Criando sua primeira APP para Smart TVs (Parte 2)","date":"2020-04-09","slug":"criando-sua-primeira-app-para-smart-tvs-parte-2"},"prevPost":{"title":"Como √© o desenvolvimento para Smart TVs","date":"2019-10-09","slug":"como-e-o-desenvolvimento-para-smart-tvs"}}}},"__N_SSG":true}